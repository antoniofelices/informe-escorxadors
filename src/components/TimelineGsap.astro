---
import { Image } from 'astro:assets';
import { Icon } from 'astro-icon/components'
const periods = Astro.props.periods;
---

<div class="container mx-auto px-4 md:px-8">
    <div class="timeline">
        <div class="timeline-line bg-linear-to-bl from-green-500 to-green-400"></div>

        {periods.map((period: any) => {
            return (
                <div class="timeline-item mb-12 grid gap-5 lg:grid-cols-4">
                    <Image src={period.image} alt={period.altImage} class='timeline-icon lg:col-span-1 lg:col-start-2' />
                    <div class="timeline-content lg:col-span-2">
                        <p><span class="bg-green-600 text-xs text-white uppercase p-1">{period.time}</span></p>
                        <h2 class="font-bold mt-3 mb-3 lg:text-4xl">{period.title}</h2>

                        <div class="model pb-3">
                            <h3 class="uppercase text-xs font-bold">
                                {period.description1}
                            </h3>
                            <p class="mb-4">{period.text1}.</p>
                            <p class="mb-4">{period.text2}.</p>
                        </div>

                        <div class="example pb-3">
                            <h3 class="uppercase text-xs font-bold">
                                {period.description3}
                            </h3>
                            <div class="flex gap-2">
                                <Icon name="folder" class="text-xl text-green-500" />
                                <p>{period.text3}.</p>
                            </div>
                        </div>
                    </div>
                </div>
            )
        })}
    </div>
</div>

<script>
    import { gsap } from "@lib/gsap"

    // Linea del timeline
    gsap.to('.timeline-line', {
        scaleY: 1,
        duration: 1.5,
        ease: 'power2.inOut',
        delay: 0.5,
    })

    // Animar cada item del timeline
    const timelineItems = document.querySelectorAll('.timeline-item')

    timelineItems.forEach((item, index) => {
        const icon = item.querySelector('.timeline-icon')
        const content = item.querySelector('.timeline-content')
        const example = item.querySelector('.example')

        // GSAP Timeline para cada item
        const tl = gsap.timeline({
            scrollTrigger: {
                trigger: item,
                start: 'top 80%',
                end: 'top 20%',
                toggleActions: 'play none none reverse',
            },
        })

        // Secuencia de animaciones
        tl.from(icon, {
            scale: 0,
            duration: 0.5,
            ease: 'back.out(1.7)',
        })
            .from(
                content,
                {
                    x: -30,
                    opacity: 0,
                    duration: 0.6,
                    ease: 'power3.out',
                },
                '-=0.2'
            )
            .from(
                example,
                {
                    opacity: 0,
                    duration: 0.4,
                    ease: 'power2.out',
                },
                '-=0.2'
            )

        // Hover effect con GSAP
        item.addEventListener('mouseenter', () => {
            gsap.to(content, {
                scale: 1.02,
                duration: 0.3,
                ease: 'power2.out',
            })
            gsap.to(icon, {
                scale: 1.1,
                rotation: 5,
                duration: 0.3,
                ease: 'back.out(2)',
            })
        })

        item.addEventListener('mouseleave', () => {
            gsap.to(content, {
                scale: 1,
                duration: 0.3,
                ease: 'power2.out',
            })
            gsap.to(icon, {
                scale: 1,
                rotation: 0,
                duration: 0.3,
                ease: 'back.out(2)',
            })
        })
    })

    // Parallax suave en scroll
    // gsap.to('.timeline-line', {
    //     scrollTrigger: {
    //         trigger: '.timeline',
    //         start: 'top top',
    //         end: 'bottom bottom',
    //         scrub: 1,
    //     },
    //     backgroundPosition: '0 100%',
    // })
</script>

<style>
    .timeline {
        position: relative;
    }

    .timeline-line {
        position: absolute;
        left: 0;
        top: 0;
        width: 4px;
        height: 100%;
        transform: scaleY(0);
        transform-origin: top;
    }
</style>
