---
import { Image } from 'astro:assets';
import { Icon } from 'astro-icon/components';
const periods = Astro.props.periods;
---

<div class="container mx-auto px-4 md:px-8">
  <div class="timeline relative">
    <div
      class="hidden timeline-line bg-linear-to-bl from-green-500 to-green-500 w-0.5 md:block md:absolute md:h-full md:w-1"
    >
    </div>

    {
      periods.map((period: any) => {
        return (
          <div class="timeline-item mb-12 grid grid-cols-1 md:gap-16 md:grid-cols-2">
            <div class="self-center justify-self-center mb-8 md:mb-0">
              <Image
                src={period.image}
                alt={period.altImage}
                class="timeline-icon"
                width={300}
              />
            </div>
            <div class="timeline-content">
              <p>
                <span class="bg-green-600 text-xs text-white uppercase p-1">
                  {period.time}
                </span>
              </p>
              <h2 class="font-bold mt-3 mb-3 lg:text-4xl">{period.title}</h2>

              <div class="description">
                <p class="mb-4 text-l">{period.text2}.</p>
              </div>

              <div class="model pb-3">
                <h3 class="uppercase text-xs font-bold">
                  {period.description1}
                </h3>
                <p class="mb-4 text-l">{period.text1}.</p>
              </div>

              <div class="example pb-3">
                <h3 class="uppercase text-xs font-bold">
                  {period.description3}
                </h3>
                <div class="flex gap-2">
                  <Icon name="folder" class="text-xl text-green-500" />
                  <p>{period.text3}.</p>
                </div>
              </div>
            </div>
          </div>
        );
      })
    }
  </div>
</div>

<script>
  import { gsap, ScrollTrigger } from '@lib/gsap';

  function initTimeline() {
    gsap.to('.timeline-line', {
      scaleY: 1,
      duration: 1.5,
      ease: 'power2.inOut',
      delay: 0.5,
    });

    const timelineItems = document.querySelectorAll('.timeline-item');

    timelineItems.forEach((item, index) => {
      const icon = item.querySelector('.timeline-icon');
      const content = item.querySelector('.timeline-content');
      const example = item.querySelector('.example');

      const tl = gsap.timeline({
        scrollTrigger: {
          trigger: item,
          start: 'top 80%',
          end: 'top 20%',
          toggleActions: 'play none none reverse',
        },
      });

      tl.from(icon, {
        scale: 0,
        duration: 0.5,
        ease: 'back.out(1.7)',
      })
        .from(
          content,
          {
            x: -30,
            opacity: 0,
            duration: 0.6,
            ease: 'power3.out',
          },
          '-=0.2'
        )
        .from(
          example,
          {
            opacity: 0,
            duration: 0.4,
            ease: 'power2.out',
          },
          '-=0.2'
        );

      item.addEventListener('mouseenter', () => {
        gsap.to(content, {
          scale: 1.02,
          duration: 0.3,
          ease: 'power2.out',
        });
        gsap.to(icon, {
          scale: 1.02,
          duration: 0.3,
          ease: 'power2.out',
        });
      });

      item.addEventListener('mouseleave', () => {
        gsap.to(content, {
          scale: 1,
          duration: 0.3,
          ease: 'power2.out',
        });
        gsap.to(icon, {
          scale: 1,
          duration: 0.3,
          ease: 'power2.out',
        });
      });
    });
  }

  document.addEventListener('astro:page-load', initTimeline);

  document.addEventListener('astro:before-preparation', () => {
    ScrollTrigger.getAll().forEach(trigger => trigger.kill());
  });
</script>

<style>
  .timeline-line {
    left: 50%;
    top: 0;
    transform: scaleY(0);
    transform-origin: top;
  }
</style>
